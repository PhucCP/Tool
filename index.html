<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkOS 6.1 - Full Power</title>
    <meta name="description" content="All-in-one personal workspace with AI">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e' },
                        dark: { 800: '#1e293b', 900: '#0f172a', 950: '#020617' }
                    },
                    animation: {
                        'spin-slow': 'spin 8s linear infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- React & Icons -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-dark-950 text-slate-800 dark:text-slate-100 transition-colors duration-300 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Home, CheckSquare, StickyNote, Clock, CreditCard, Plus, Trash2, Save, X, 
            Play, Pause, RotateCcw, Sun, Moon, Menu, ArrowRightLeft, Code, Database, 
            Bitcoin, Key, Globe, QrCode, Timer, FileText, RefreshCw, Copy, Check, 
            Lock, Link as LinkIcon, Download, Music, Youtube, Cloud, Disc, Shuffle,
            Maximize2, Minimize2, Video, Volume2, VolumeX, SkipForward, SkipBack,
            Bot, Mic, BarChart, ArrowRight, ArrowLeft, ExternalLink, Columns,
            AlertCircle, Sparkles, Wand2, Settings, Upload, Download as DownloadIcon,
            Calendar as CalendarIcon, Zap, Coffee, Eye, EyeOff, Film
        } from 'lucide-react';

        // --- UTILS ---
        const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);
        
        // --- API HELPERS ---
        const callGemini = async (prompt, apiKey) => {
            if (!apiKey) return "‚ö†Ô∏è Vui l√≤ng nh·∫≠p API Key trong ph·∫ßn C√†i ƒë·∫∑t (Settings) ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y.";
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
                    }
                );
                if (!response.ok) throw new Error(`Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Kh√¥ng c√≥ ph·∫£n h·ªìi.";
            } catch (error) {
                return `L·ªói k·∫øt n·ªëi AI: ${error.message}`;
            }
        };

        // --- COMPONENTS ---
        const Card = ({ children, className = "", onClick }) => (
            <div onClick={onClick} className={`bg-white dark:bg-dark-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 p-6 transition-all ${className}`}>
                {children}
            </div>
        );

        const Button = ({ onClick, children, variant = "primary", className = "", icon: Icon, disabled = false, loading = false, size = "md" }) => {
            const baseStyle = "rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-2 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed";
            const sizes = { sm: "px-3 py-1.5 text-xs", md: "px-4 py-2.5 text-sm", lg: "px-6 py-3 text-base" };
            const variants = {
                primary: "bg-primary-600 hover:bg-primary-700 text-white shadow-lg shadow-primary-500/30",
                secondary: "bg-white dark:bg-dark-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",
                danger: "bg-red-500 hover:bg-red-600 text-white shadow-lg shadow-red-500/30",
                ghost: "hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-300",
                magic: "bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-700 hover:to-indigo-700 text-white shadow-lg shadow-indigo-500/30 border-none"
            };
            return (
                <button onClick={onClick} disabled={disabled || loading} className={`${baseStyle} ${sizes[size]} ${variants[variant]} ${className}`}>
                    {loading ? <RefreshCw size={18} className="animate-spin" /> : (Icon && <Icon size={18} />)}
                    {children}
                </button>
            );
        };

        const Input = ({ value, onChange, placeholder, className="", type="text", onKeyDown }) => (
            <input 
                type={type} value={value} onChange={onChange} placeholder={placeholder} onKeyDown={onKeyDown}
                className={`w-full bg-gray-50 dark:bg-dark-900 border border-gray-200 dark:border-gray-700 rounded-xl px-4 py-2.5 outline-none focus:ring-2 focus:ring-primary-500/50 transition-all ${className}`}
            />
        );

        // --- RESTORED & UPGRADED FEATURES ---

        // FINANCE APP
        const FinanceApp = ({ expenses, setExpenses }) => {
            const [desc, setDesc] = useState(''); const [amt, setAmt] = useState('');
            const add = (e) => { e.preventDefault(); if (!desc) return; setExpenses([...expenses, { id: generateId(), desc, amount: parseFloat(amt), date: new Date().toLocaleDateString('vi') }]); setDesc(''); setAmt(''); };
            const total = expenses.reduce((a, b) => a + b.amount, 0); const maxVal = Math.max(...expenses.map(e => e.amount), 1) || 1;
            return (
                <div className="max-w-5xl mx-auto space-y-6 animate-fade-in">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <Card className="col-span-1 md:col-span-2">
                            <h2 className="text-2xl font-bold mb-6 flex gap-2 text-green-600"><CreditCard/> Qu·∫£n l√Ω T√†i ch√≠nh</h2>
                            <form onSubmit={add} className="flex gap-3 mb-6">
                                <Input value={desc} onChange={e=>setDesc(e.target.value)} placeholder="Chi ti√™u cho vi·ªác g√¨..." />
                                <Input value={amt} onChange={e=>setAmt(e.target.value)} placeholder="S·ªë ti·ªÅn..." type="number" className="w-32" />
                                <Button type="submit" icon={Plus} variant="primary">L∆∞u</Button>
                            </form>
                            <div className="space-y-3 max-h-80 overflow-auto pr-2">
                                {expenses.map(e => (
                                    <div key={e.id} className="flex justify-between items-center p-3 bg-gray-50 dark:bg-dark-900/50 rounded-xl border border-gray-100 dark:border-gray-800">
                                        <div><div className="font-medium">{e.desc}</div><div className="text-xs text-gray-400">{e.date}</div></div>
                                        <div className="flex items-center gap-3"><span className="font-bold text-red-500">-{e.amount.toLocaleString()}ƒë</span><button onClick={()=>setExpenses(expenses.filter(x=>x.id!==e.id))} className="text-gray-400 hover:text-red-500"><Trash2 size={16}/></button></div>
                                    </div>
                                ))}
                            </div>
                        </Card>
                        <div className="space-y-6">
                            <Card className="bg-green-50 dark:bg-green-900/10 border-green-100 dark:border-green-900">
                                <h3 className="text-green-800 dark:text-green-400 font-bold uppercase text-xs tracking-wider">T·ªïng chi ti√™u</h3>
                                <div className="text-3xl font-bold text-green-600 dark:text-green-400 mt-2">{total.toLocaleString()}ƒë</div>
                            </Card>
                            <Card>
                                <h3 className="font-bold mb-4 flex gap-2 text-sm"><BarChart size={16}/> Bi·ªÉu ƒë·ªì g·∫ßn ƒë√¢y</h3>
                                <div className="flex items-end gap-2 h-40 pt-4 border-b border-gray-100 dark:border-gray-700">
                                    {expenses.slice(-5).map((e, i) => (
                                        <div key={i} className="flex-1 flex flex-col items-center gap-1 group relative">
                                            <div className="w-full bg-green-400 rounded-t-lg hover:bg-green-500 transition-all" style={{ height: `${Math.max((e.amount / maxVal) * 100, 10)}%` }}></div>
                                        </div>
                                    ))}
                                    {expenses.length===0 && <div className="text-xs text-gray-400 w-full text-center">Ch∆∞a c√≥ d·ªØ li·ªáu</div>}
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );
        };

        // MUSIC PLAYER
        const MusicPlayer = ({ songs, setSongs }) => {
            const [idx, setIdx] = useState(0); const [play, setPlay] = useState(false); const ref = useRef(null); const [nw, setNw] = useState({t:'',u:''});
            useEffect(() => { if (songs.length === 0) setSongs([{ id: 1, title: 'Lofi Chill 1', url: 'https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3' }]); }, []);
            useEffect(() => { if (play) ref.current.play(); else ref.current.pause(); }, [play, idx]);
            return (
                <div className="max-w-3xl mx-auto space-y-6 animate-fade-in">
                    <Card className="bg-gradient-to-br from-pink-500 to-rose-600 text-white border-none overflow-hidden relative">
                        <div className="absolute top-0 right-0 p-8 opacity-20"><Music size={120} /></div>
                        <div className="flex items-center gap-6 relative z-10">
                            <div className={`w-28 h-28 bg-white/20 rounded-full flex items-center justify-center border-4 border-white/10 ${play?'animate-spin-slow':''}`}><Disc size={60}/></div>
                            <div className="flex-1 min-w-0">
                                <h3 className="text-xs font-bold uppercase tracking-widest opacity-70 mb-1">ƒêang ph√°t</h3>
                                <h2 className="text-3xl font-bold truncate mb-6">{songs[idx]?.title||'Ch∆∞a ch·ªçn b√†i'}</h2>
                                <audio ref={ref} src={songs[idx]?.url} onEnded={()=>setIdx((idx+1)%songs.length)} />
                                <div className="flex gap-6">
                                    <button onClick={()=>setIdx((idx-1+songs.length)%songs.length)} className="hover:opacity-70 transition-opacity"><SkipBack size={28}/></button>
                                    <button onClick={()=>setPlay(!play)} className="w-12 h-12 bg-white text-pink-600 rounded-full flex items-center justify-center hover:scale-105 transition-transform shadow-lg">{play?<Pause fill="currentColor"/>:<Play fill="currentColor" className="ml-1"/>}</button>
                                    <button onClick={()=>setIdx((idx+1)%songs.length)} className="hover:opacity-70 transition-opacity"><SkipForward size={28}/></button>
                                </div>
                            </div>
                        </div>
                    </Card>
                    <Card>
                        <h3 className="font-bold mb-4 flex gap-2"><Music size={20} className="text-pink-500"/> Danh s√°ch ph√°t</h3>
                        <div className="flex gap-2 mb-4">
                            <Input value={nw.t} onChange={e=>setNw({...nw,t:e.target.value})} placeholder="T√™n b√†i h√°t..." />
                            <Input value={nw.u} onChange={e=>setNw({...nw,u:e.target.value})} placeholder="Link MP3..." />
                            <Button onClick={()=>{if(nw.t&&nw.u)setSongs([...songs,{id:generateId(),...nw}]); setNw({t:'',u:''})}} icon={Plus}>Th√™m</Button>
                        </div>
                        <div className="space-y-2 max-h-64 overflow-auto">
                            {songs.map((s,i)=>(
                                <div key={s.id} onClick={()=>{setIdx(i);setPlay(true)}} className={`flex justify-between items-center p-3 rounded-xl cursor-pointer transition-colors ${i===idx?'bg-pink-50 dark:bg-pink-900/20 text-pink-600 font-medium':'hover:bg-gray-50 dark:hover:bg-dark-700'}`}>
                                    <div className="flex items-center gap-3"><span className="text-xs opacity-50 w-4">{i+1}</span>{s.title}</div>
                                    <button onClick={(e)=>{e.stopPropagation();setSongs(songs.filter(x=>x.id!==s.id))}} className="text-gray-400 hover:text-red-500"><Trash2 size={16}/></button>
                                </div>
                            ))}
                        </div>
                    </Card>
                </div>
            );
        };

        // CRYPTO MARKET
        const CryptoMarket = () => {
            const [coins, setCoins] = useState([]); const [loading, setLoading] = useState(false);
            const fetchMarket = async () => { setLoading(true); try { const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,binancecoin,solana,cardano,ripple,dogecoin,polkadot&vs_currencies=usd,vnd&include_24hr_change=true'); const d = await r.json(); setCoins(Object.keys(d).map(k => ({ id: k, name: k.charAt(0).toUpperCase() + k.slice(1), usd: d[k].usd, vnd: d[k].vnd, chg: d[k].usd_24h_change }))); } catch (e) { console.error(e); } finally { setLoading(false); } };
            useEffect(() => { fetchMarket(); }, []);
            return (
                <div className="max-w-4xl mx-auto animate-fade-in">
                    <Card>
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold flex items-center gap-2"><Bitcoin className="text-orange-500"/> Th·ªã tr∆∞·ªùng Crypto</h2>
                            <Button onClick={fetchMarket} variant="outline" icon={RefreshCw} loading={loading}>C·∫≠p nh·∫≠t</Button>
                        </div>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left">
                                <thead><tr className="border-b border-gray-100 dark:border-gray-700 text-gray-500 text-sm"><th className="py-3 px-4">Coin</th><th className="py-3 px-4">Gi√° USD</th><th className="py-3 px-4">Gi√° VND</th><th className="py-3 px-4">24h</th></tr></thead>
                                <tbody>
                                    {coins.map(c => (
                                        <tr key={c.id} className="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-dark-700/50 transition-colors">
                                            <td className="py-3 px-4 font-bold capitalize flex items-center gap-2"><img src={`https://assets.coingecko.com/coins/images/1/small/${c.id === 'binancecoin' ? 'binance_coin' : c.id}.png?1547033579`} onError={e=>e.target.style.display='none'} className="w-6 h-6 rounded-full"/>{c.name}</td>
                                            <td className="py-3 px-4 font-mono">${c.usd.toLocaleString()}</td>
                                            <td className="py-3 px-4 font-mono text-gray-500">‚Ç´{c.vnd.toLocaleString()}</td>
                                            <td className={`py-3 px-4 font-bold ${c.chg >= 0 ? 'text-green-500' : 'text-red-500'}`}>{c.chg.toFixed(2)}%</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </Card>
                </div>
            );
        };

        // LUCKY WHEEL
        const LuckyWheel = () => {
            const [it, sIt] = useState(['Ph·ªü','C∆°m','B√∫n','M√¨']); const [n, sN] = useState(''); const [res, sRes] = useState(''); const [spin, setSpin] = useState(false);
            const run = () => { if(it.length<2) return; setSpin(true); let c=0; const i = setInterval(()=>{ sRes(it[Math.floor(Math.random()*it.length)]); c++; if(c>20){ clearInterval(i); setSpin(false); } }, 100); };
            return (
                <div className="max-w-xl mx-auto animate-fade-in">
                    <Card className="text-center">
                        <h2 className="text-2xl font-bold mb-8 flex justify-center gap-2"><Shuffle className="text-purple-500"/> V√≤ng quay May m·∫Øn</h2>
                        <div className="h-40 flex items-center justify-center mb-8 bg-purple-50 dark:bg-purple-900/10 rounded-2xl border-2 border-dashed border-purple-200 dark:border-purple-800">
                            <div className={`text-4xl font-bold text-purple-600 dark:text-purple-400 ${spin?'animate-pulse':''}`}>{res||'???'}</div>
                        </div>
                        <Button onClick={run} disabled={spin || it.length<2} className="w-full py-4 text-lg bg-purple-600 hover:bg-purple-700" size="lg">QUAY NGAY</Button>
                        <div className="mt-8 text-left border-t border-gray-100 dark:border-gray-700 pt-6">
                            <label className="text-sm font-bold text-gray-500 mb-2 block">Danh s√°ch l·ª±a ch·ªçn</label>
                            <div className="flex gap-2 mb-4">
                                <Input value={n} onChange={e=>sN(e.target.value)} placeholder="Th√™m l·ª±a ch·ªçn..." onKeyDown={e=>e.key==='Enter' && n && (sIt([...it,n]),sN(''))} />
                                <Button onClick={()=>{if(n)sIt([...it,n]);sN('')}} icon={Plus}>Th√™m</Button>
                            </div>
                            <div className="flex flex-wrap gap-2">
                                {it.map((x,i)=><span key={i} className="bg-gray-100 dark:bg-dark-700 px-3 py-1 rounded-full text-sm flex items-center gap-2">{x}<button onClick={()=>sIt(it.filter((_,j)=>j!==i))} className="hover:text-red-500"><X size={12}/></button></span>)}
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };

        // VOICE RECORDER
        const VoiceRecorder = () => { 
            const [rec, setRec] = useState(false); const [list, setList] = useState([]); const ref = useRef(null);
            const start = async () => { try { const s = await navigator.mediaDevices.getUserMedia({ audio: true }); ref.current = new MediaRecorder(s); const c = []; ref.current.ondataavailable = e => c.push(e.data); ref.current.onstop = () => setList(p => [{ id: Date.now(), url: URL.createObjectURL(new Blob(c)), date: new Date().toLocaleTimeString() }, ...p]); ref.current.start(); setRec(true); } catch { alert('Kh√¥ng th·ªÉ truy c·∫≠p Mic!'); } }; 
            const stop = () => { ref.current.stop(); setRec(false); }; 
            return (
                <div className="max-w-xl mx-auto animate-fade-in">
                    <Card className="text-center">
                        <h2 className="text-2xl font-bold mb-8 flex justify-center gap-2"><Mic className="text-teal-500"/> Ghi √¢m Gi·ªçng n√≥i</h2>
                        <div className="mb-10 flex justify-center">
                            <div className={`w-32 h-32 rounded-full flex items-center justify-center transition-all duration-300 ${rec?'bg-red-100 dark:bg-red-900/30 animate-pulse shadow-xl shadow-red-500/20':'bg-gray-100 dark:bg-dark-700'}`}>
                                <Mic size={48} className={rec?'text-red-500':'text-gray-400'}/>
                            </div>
                        </div>
                        <div className="flex justify-center gap-4 mb-8">
                            {!rec ? <Button onClick={start} size="lg" className="w-40 bg-teal-600 hover:bg-teal-700">B·∫Øt ƒë·∫ßu</Button> : <Button onClick={stop} variant="danger" size="lg" className="w-40">D·ª´ng l·∫°i</Button>}
                        </div>
                        <div className="space-y-3 text-left border-t border-gray-100 dark:border-gray-700 pt-6">
                            <h3 className="font-bold text-gray-500 text-sm">B·∫£n ghi √¢m</h3>
                            {list.map(l=><div key={l.id} className="flex justify-between items-center p-3 bg-gray-50 dark:bg-dark-700 rounded-xl"><span className="text-sm font-mono">{l.date}</span><audio src={l.url} controls className="h-8 w-48"/></div>)}
                            {list.length===0 && <p className="text-gray-400 text-center text-sm">Ch∆∞a c√≥ b·∫£n ghi n√†o</p>}
                        </div>
                    </Card>
                </div>
            ); 
        };

        // WORLD CLOCK
        const WorldClock = () => {
            const [t, sT] = useState(new Date()); useEffect(()=>{const i=setInterval(()=>sT(new Date()),1000);return ()=>clearInterval(i)},[]);
            const c=[{n:'H√† N·ªôi',z:'Asia/Ho_Chi_Minh',f:'üáªüá≥'},{n:'Tokyo',z:'Asia/Tokyo',f:'üáØüáµ'},{n:'New York',z:'America/New_York',f:'üá∫üá∏'},{n:'London',z:'Europe/London',f:'üá¨üáß'},{n:'Paris',z:'Europe/Paris',f:'üá´üá∑'},{n:'Sydney',z:'Australia/Sydney',f:'üá¶üá∫'}];
            return (
                <div className="max-w-5xl mx-auto animate-fade-in">
                    <Card>
                        <h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><Globe className="text-cyan-500"/> ƒê·ªìng h·ªì Th·∫ø gi·ªõi</h2>
                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6">
                            {c.map(x=>{
                                const timeStr = t.toLocaleTimeString('vi',{timeZone:x.z,hour:'2-digit',minute:'2-digit'});
                                const dateStr = t.toLocaleDateString('vi',{timeZone:x.z,day:'numeric',month:'numeric'});
                                return (
                                    <div key={x.n} className="p-6 rounded-2xl border border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-dark-900/50 flex flex-col items-center hover:scale-105 transition-transform">
                                        <div className="text-3xl mb-2">{x.f}</div>
                                        <span className="text-gray-500 dark:text-gray-400 font-bold uppercase text-sm">{x.n}</span>
                                        <span className="text-3xl font-mono font-bold my-2 text-cyan-600 dark:text-cyan-400">{timeStr}</span>
                                        <span className="text-xs text-gray-400">{dateStr}</span>
                                    </div>
                                )
                            })}
                        </div>
                    </Card>
                </div>
            );
        };

        // DEV TOOLS
        const DevToolsApp = () => {
            const [v,sV]=useState(''); const [o,sO]=useState('');
            return (
                <div className="max-w-4xl mx-auto animate-fade-in">
                    <Card>
                        <h2 className="text-2xl font-bold mb-6 flex gap-2"><Code className="text-green-500"/> Developer Tools</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 h-80 mb-6">
                            <div className="flex flex-col"><label className="text-sm font-bold text-gray-500 mb-2">Input</label><textarea value={v} onChange={e=>sV(e.target.value)} className="flex-1 p-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-dark-900 resize-none font-mono text-sm focus:ring-2 focus:ring-green-500/50 outline-none" placeholder="Paste text/JSON here..."/></div>
                            <div className="flex flex-col"><label className="text-sm font-bold text-gray-500 mb-2">Output</label><textarea value={o} readOnly className="flex-1 p-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-100 dark:bg-dark-950 resize-none font-mono text-sm text-gray-600 dark:text-gray-300"/></div>
                        </div>
                        <div className="flex gap-3 justify-center">
                            <Button onClick={()=>sO(JSON.stringify(JSON.parse(v),null,2))} variant="primary">Format JSON</Button>
                            <Button onClick={()=>sO(btoa(v))} variant="secondary">Base64 Encode</Button>
                            <Button onClick={()=>sO(atob(v))} variant="secondary">Base64 Decode</Button>
                            <Button onClick={()=>{sV('');sO('')}} variant="ghost" icon={RotateCcw}>Clear</Button>
                        </div>
                    </Card>
                </div>
            );
        };

        // UTILS APPS (Password, QR, Stopwatch, Vault)
        const PasswordGen = () => { const [l,sL]=useState(12); const [p,sP]=useState(''); return (<div className="max-w-xl mx-auto animate-fade-in"><Card><h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><Key className="text-red-500"/> T·∫°o M·∫≠t kh·∫©u</h2><div className="bg-gray-100 dark:bg-dark-900 p-4 rounded-xl mb-6 font-mono text-xl flex justify-between items-center"><span className="break-all">{p||'...'}</span>{p&&<CopyButton text={p}/>}</div><input type="range" min="6" max="32" value={l} onChange={e=>sL(e.target.value)} className="w-full mb-2"/><div className="text-center text-sm text-gray-500 mb-6">ƒê·ªô d√†i: {l}</div><Button onClick={()=>{let c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*';let r='';for(let i=0;i<l;i++)r+=c[Math.floor(Math.random()*c.length)];sP(r)}} className="w-full">T·∫°o ngay</Button></Card></div>); };
        const QRGen = () => { const [t,sT]=useState(''); const [u,sU]=useState(''); return (<div className="max-w-xl mx-auto animate-fade-in"><Card><h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><QrCode className="text-purple-500"/> T·∫°o m√£ QR</h2><div className="flex gap-2 mb-6"><Input value={t} onChange={e=>sT(e.target.value)} placeholder="Nh·∫≠p n·ªôi dung..." /><Button onClick={()=>sU(`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(t)}`)}>T·∫°o</Button></div>{u&&<div className="flex justify-center p-4 bg-white rounded-xl shadow-inner border"><img src={u} alt="QR"/></div>}</Card></div>); };
        const StopwatchApp = () => { const [t,sT]=useState(0); const [r,sR]=useState(false); useEffect(()=>{let i;if(r)i=setInterval(()=>sT(p=>p+10),10);return()=>clearInterval(i)},[r]); return (<div className="max-w-xl mx-auto animate-fade-in"><Card className="text-center"><h2 className="text-2xl font-bold mb-8 flex justify-center gap-2"><Timer className="text-yellow-500"/> B·∫•m gi·ªù</h2><div className="text-7xl font-mono mb-10 font-bold tracking-tighter text-slate-800 dark:text-white">{new Date(t).toISOString().slice(14,22)}</div><div className="flex justify-center gap-4"><Button onClick={()=>sR(!r)} size="lg" className={r?'bg-yellow-500 hover:bg-yellow-600':''}>{r?'D·ª´ng':'B·∫Øt ƒë·∫ßu'}</Button><Button onClick={()=>{sR(false);sT(0)}} variant="outline" size="lg">ƒê·∫∑t l·∫°i</Button></div></Card></div>); };
        const VaultApp = ({ i, sI }) => { const [n, sN] = useState({t:'',c:''}); return (<div className="max-w-4xl mx-auto space-y-6 animate-fade-in"><Card><h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><Database className="text-indigo-500"/> Kho l∆∞u tr·ªØ</h2><div className="flex gap-2 mb-4"><Input value={n.t} onChange={e=>sN({...n,t:e.target.value})} placeholder="Ti√™u ƒë·ªÅ..." /><Button onClick={()=>{if(n.t)sI([...i,{id:generateId(),...n}]);sN({t:'',c:''})}} icon={Plus}>L∆∞u</Button></div><textarea value={n.c} onChange={e=>sN({...n,c:e.target.value})} placeholder="N·ªôi dung c·∫ßn l∆∞u (Code, Link, Text)..." className="w-full p-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-dark-900 mb-4 h-32 resize-none outline-none"/><div className="grid grid-cols-1 md:grid-cols-2 gap-4">{i.map(x=><div key={x.id} className="p-4 border border-gray-100 dark:border-gray-700 rounded-xl bg-white dark:bg-dark-900 shadow-sm flex flex-col justify-between h-32 group"><div className="font-bold truncate">{x.t}</div><div className="text-xs text-gray-500 line-clamp-2 font-mono bg-gray-50 dark:bg-dark-800 p-2 rounded">{x.c}</div><div className="flex justify-end gap-2 mt-2 opacity-0 group-hover:opacity-100 transition-opacity"><CopyButton text={x.c}/><button onClick={()=>sI(i.filter(y=>y.id!==x.id))} className="text-gray-400 hover:text-red-500 p-2"><Trash2 size={16}/></button></div></div>)}</div></Card></div>); };

        // PREVIOUS FEATURES (Maintained)
        const Dashboard = ({ setActiveTab, tasks, weather, openSettings }) => {
            const [time, setTime] = useState(new Date());
            useEffect(() => { const i = setInterval(() => setTime(new Date()), 1000); return () => clearInterval(i); }, []);
            const hours = time.getHours();
            const greeting = hours < 12 ? 'Ch√†o bu·ªïi s√°ng' : hours < 18 ? 'Ch√†o bu·ªïi chi·ªÅu' : 'Ch√†o bu·ªïi t·ªëi';
            const pendingTasks = tasks.filter(t => t.status !== 'done').length;

            const FeatureBtn = ({ id, icon: Icon, title, sub, color, isNew }) => (
                <button onClick={() => setActiveTab(id)} className="group relative p-5 bg-white dark:bg-dark-800 border border-gray-100 dark:border-gray-800 rounded-2xl hover:shadow-xl hover:-translate-y-1 transition-all duration-300 text-left overflow-hidden">
                    <div className={`absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-10 group-hover:scale-125 transition-all duration-500 ${color}`}><Icon size={100} /></div>
                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center mb-4 ${color.replace('text-', 'bg-').replace('600', '100')} dark:bg-opacity-20`}><Icon size={24} className={color} /></div>
                    <h3 className="font-bold text-lg mb-1 flex items-center gap-2">{title} {isNew && <span className="bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full animate-pulse">NEW</span>}</h3>
                    <p className="text-sm text-gray-500 dark:text-gray-400">{sub}</p>
                </button>
            );

            return (
                <div className="space-y-8 animate-fade-in pb-20">
                    <div className="relative rounded-3xl overflow-hidden bg-gradient-to-r from-primary-600 to-indigo-600 text-white p-8 md:p-12 shadow-2xl shadow-primary-500/20">
                        <div className="relative z-10 max-w-2xl"><h1 className="text-4xl md:text-5xl font-bold mb-4">{greeting}, Boss!</h1><p className="text-primary-100 text-lg mb-8">WorkOS 6.1 ƒë√£ ƒë∆∞·ª£c n·∫°p ƒë·∫ßy ƒë·ªß nƒÉng l∆∞·ª£ng.</p><div className="flex flex-wrap gap-4"><button onClick={() => setActiveTab('kanban')} className="px-6 py-3 bg-white text-primary-600 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all">Qu·∫£n l√Ω vi·ªác</button><button onClick={() => setActiveTab('zen')} className="px-6 py-3 bg-indigo-500/30 backdrop-blur border border-white/20 text-white rounded-xl font-bold hover:bg-indigo-500/50 transition-all flex items-center gap-2"><Zap size={18}/> Zen Mode</button></div></div>
                        <div className="absolute right-0 bottom-0 opacity-10"><Bot size={300} /></div>
                        <div className="absolute top-8 right-8 text-right hidden md:block"><div className="text-5xl font-mono font-bold tracking-tight">{time.toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'})}</div><div className="flex items-center justify-end gap-2 mt-2 text-primary-100"><Cloud size={18} /><span>{weather?.current?.temperature_2m || '--'}¬∞C ‚Ä¢ H√† N·ªôi</span></div></div>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="p-4 bg-white dark:bg-dark-800 rounded-2xl border border-gray-100 dark:border-gray-800 flex items-center gap-4"><div className="p-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-xl"><CheckSquare size={24}/></div><div><div className="text-2xl font-bold">{pendingTasks}</div><div className="text-xs text-gray-500">Vi·ªác c·∫ßn l√†m</div></div></div>
                        <div className="p-4 bg-white dark:bg-dark-800 rounded-2xl border border-gray-100 dark:border-gray-800 flex items-center gap-4 cursor-pointer hover:bg-gray-50 transition-colors" onClick={openSettings}><div className="p-3 bg-gray-100 dark:bg-gray-700 text-gray-600 rounded-xl"><Settings size={24}/></div><div><div className="text-2xl font-bold">C√†i ƒë·∫∑t</div><div className="text-xs text-gray-500">System</div></div></div>
                    </div>
                    <h2 className="text-xl font-bold flex items-center gap-2"><Sparkles className="text-yellow-500"/> C√¥ng c·ª• th√¥ng minh</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <FeatureBtn id="kanban" icon={Columns} title="Kanban AI" sub="L·∫≠p k·∫ø ho·∫°ch" color="text-blue-600" isNew />
                        <FeatureBtn id="aichat" icon={Bot} title="Tr·ª£ l√Ω Gemini" sub="Chat th√¥ng minh" color="text-purple-600" isNew />
                        <FeatureBtn id="notes" icon={StickyNote} title="Magic Notes" sub="Ghi ch√∫ AI" color="text-yellow-500" isNew />
                        <FeatureBtn id="calendar" icon={CalendarIcon} title="L·ªãch tr√¨nh" sub="Xem th√°ng" color="text-teal-500" />
                    </div>
                    <h2 className="text-xl font-bold flex items-center gap-2 mt-8"><Film className="text-red-500"/> Gi·∫£i tr√≠ & Media</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <FeatureBtn id="youtube" icon={Youtube} title="YouTube" sub="Xem kh√¥ng qu·∫£ng c√°o" color="text-red-600" />
                        <FeatureBtn id="music" icon={Music} title="Music Player" sub="Nghe nh·∫°c" color="text-pink-500" />
                        <FeatureBtn id="zen" icon={Zap} title="Zen Mode" sub="Si√™u t·∫≠p trung" color="text-indigo-500" isNew />
                        <FeatureBtn id="lucky" icon={Shuffle} title="V√≤ng quay" sub="Quy·∫øt ƒë·ªãnh" color="text-orange-500" />
                    </div>
                    <h2 className="text-xl font-bold flex items-center gap-2 mt-8"><Code className="text-green-500"/> Ti·ªán √≠ch kh√°c</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <FeatureBtn id="finance" icon={CreditCard} title="T√†i ch√≠nh" sub="Qu·∫£n l√Ω chi ti√™u" color="text-green-600" />
                        <FeatureBtn id="crypto" icon={Bitcoin} title="Crypto" sub="Gi√° Coin" color="text-orange-500" />
                        <FeatureBtn id="vault" icon={Database} title="Kho l∆∞u tr·ªØ" sub="L∆∞u nhanh" color="text-blue-500" />
                        <FeatureBtn id="devtools" icon={Code} title="DevTools" sub="JSON/Base64" color="text-gray-600" />
                        <FeatureBtn id="voice" icon={Mic} title="Ghi √¢m" sub="L∆∞u gi·ªçng n√≥i" color="text-teal-500" />
                        <FeatureBtn id="worldclock" icon={Globe} title="Th·∫ø gi·ªõi" sub="M√∫i gi·ªù" color="text-cyan-500" />
                        <FeatureBtn id="password" icon={Key} title="Password" sub="T·∫°o m·∫≠t kh·∫©u" color="text-red-500" />
                        <FeatureBtn id="qr" icon={QrCode} title="QR Code" sub="T·∫°o m√£ QR" color="text-purple-500" />
                        <FeatureBtn id="stopwatch" icon={Timer} title="B·∫•m gi·ªù" sub="ƒê·∫øm th·ªùi gian" color="text-yellow-500" />
                    </div>
                </div>
            );
        };

        const ZenMode = ({ tasks, onClose }) => {
            const [time, setTime] = useState(new Date());
            useEffect(() => { const i = setInterval(() => setTime(new Date()), 1000); return () => clearInterval(i); }, []);
            return (
                <div className="fixed inset-0 z-50 bg-gray-900 text-white flex flex-col items-center justify-center p-8 animate-fade-in bg-[url('https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
                    <div className="relative z-10 text-center max-w-2xl w-full">
                        <button onClick={onClose} className="absolute top-8 right-8 p-4 text-white/50 hover:text-white"><X size={32}/></button>
                        <div className="text-9xl font-mono font-bold tracking-tighter mb-4 opacity-90">{time.toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'})}</div>
                        <p className="text-2xl text-gray-300 font-light italic mb-12">"T·∫≠p trung v√†o hi·ªán t·∫°i."</p>
                        <div className="bg-white/10 backdrop-blur-md p-8 rounded-3xl border border-white/10 text-left">
                            <h3 className="text-xs uppercase tracking-widest text-gray-400 mb-6 font-bold">M·ª§C TI√äU H√îM NAY</h3>
                            <div className="space-y-4">{tasks.filter(t=>t.status==='todo').slice(0,3).map(t=>(<div key={t.id} className="flex items-center gap-4 text-xl"><div className="w-4 h-4 rounded-full border-2 border-white/50"></div><span>{t.text}</span></div>))}</div>
                        </div>
                    </div>
                </div>
            );
        };

        const SettingsModal = ({ isOpen, onClose, apiKey, setApiKey, exportData, importData }) => {
            if (!isOpen) return null;
            const [keyInput, setKeyInput] = useState(apiKey);
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
                    <Card className="w-full max-w-lg relative animate-float">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-red-500"><X size={20}/></button>
                        <h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><Settings className="text-gray-500"/> C√†i ƒë·∫∑t</h2>
                        <div className="space-y-6">
                            <div><label className="block text-sm font-bold mb-2">Gemini API Key</label><Input type="password" value={keyInput} onChange={e => setKeyInput(e.target.value)} placeholder="Nh·∫≠p kh√≥a API..." /></div>
                            <div className="border-t pt-6 grid grid-cols-2 gap-4"><Button onClick={exportData} variant="secondary" icon={DownloadIcon}>Xu·∫•t d·ªØ li·ªáu</Button><label className="flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl border border-gray-200 dark:border-gray-700 hover:bg-gray-50 cursor-pointer text-sm font-medium"><Upload size={18}/> Nh·∫≠p<input type="file" accept=".json" onChange={e => {const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>importData(ev.target.result);r.readAsText(f)}}} className="hidden" /></label></div>
                            <Button onClick={()=>{setApiKey(keyInput);localStorage.setItem('gemini_api_key',keyInput);onClose()}} className="w-full">L∆∞u</Button>
                        </div>
                    </Card>
                </div>
            );
        };

        const Kanban = ({ tasks, setTasks, apiKey, openSettings }) => {
            const [input, setInput] = useState(''); const [loading, setLoading] = useState(false);
            const addTask = () => { if (!input.trim()) return; setTasks([...tasks, { id: generateId(), text: input, status: 'todo', date: new Date().toISOString() }]); setInput(''); };
            const aiPlan = async () => { if (!apiKey) return openSettings(); if (!input.trim()) return alert("Nh·∫≠p m·ª•c ti√™u!"); setLoading(true); const res = await callGemini(`Li·ªát k√™ 5 ƒë·∫ßu vi·ªác ng·∫Øn g·ªçn ƒë·ªÉ: "${input}". Tr·∫£ v·ªÅ list c√°ch nhau b·ªüi d·∫•u ph·∫©y.`, apiKey); setLoading(false); if (res) { const items = res.split(/,/).map(t => t.trim()).filter(t => t); setTasks([...tasks, ...items.map(t => ({ id: generateId(), text: t, status: 'todo', date: new Date().toISOString() }))]); setInput(''); } };
            const move = (id, s) => setTasks(tasks.map(t => t.id === id ? { ...t, status: s } : t));
            const Col = ({ id, title, icon: Icon, color }) => (<div className="flex-1 min-w-[300px] bg-gray-100 dark:bg-dark-900/50 rounded-2xl p-4 flex flex-col h-[600px]"><div className={`flex items-center gap-2 font-bold mb-4 ${color}`}><Icon size={20}/> {title} <span className="bg-white dark:bg-dark-800 px-2 rounded-full text-xs py-0.5 border shadow-sm text-gray-500">{tasks.filter(t => t.status === id).length}</span></div><div className="flex-1 overflow-y-auto space-y-3">{tasks.filter(t => t.status === id).map(t => (<div key={t.id} className="bg-white dark:bg-dark-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm group"><p className="text-sm font-medium mb-3">{t.text}</p><div className="flex justify-between items-center opacity-50 group-hover:opacity-100 transition-opacity"><div className="flex gap-1">{id !== 'todo' && <button onClick={() => move(t.id, id === 'done' ? 'doing' : 'todo')} className="p-1 hover:bg-gray-100 rounded-lg"><ArrowLeft size={14}/></button>}{id !== 'done' && <button onClick={() => move(t.id, id === 'todo' ? 'doing' : 'done')} className="p-1 hover:bg-gray-100 rounded-lg"><ArrowRight size={14}/></button>}</div><button onClick={() => setTasks(tasks.filter(x=>x.id!==t.id))} className="text-red-400 hover:text-red-500"><Trash2 size={16}/></button></div></div>))}</div></div>);
            return (<div className="h-full flex flex-col animate-fade-in"><div className="mb-6 flex gap-4 items-center"><h2 className="text-2xl font-bold flex gap-2"><Columns className="text-blue-600"/> Kanban</h2><div className="flex gap-2 w-full md:w-auto"><Input value={input} onChange={e=>setInput(e.target.value)} placeholder="C√¥ng vi·ªác..." onKeyDown={e=>e.key==='Enter'&&addTask()}/><Button onClick={addTask} icon={Plus}>Th√™m</Button><Button onClick={aiPlan} variant="magic" icon={Sparkles} loading={loading}>AI</Button></div></div><div className="flex gap-6 overflow-x-auto pb-6 h-full"><Col id="todo" title="C·∫ßn l√†m" icon={CheckSquare} color="text-gray-500" /><Col id="doing" title="ƒêang l√†m" icon={Clock} color="text-blue-500" /><Col id="done" title="Ho√†n th√†nh" icon={Check} color="text-green-500" /></div></div>);
        };

        const YouTube = () => {
            const [url, setUrl] = useState(''); const [vid, setVid] = useState('');
            const load = () => { const m = url.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/); if (m && m[7].length === 11) setVid(m[7]); else alert("Link l·ªói"); };
            return (<div className="max-w-4xl mx-auto space-y-6 animate-fade-in"><Card><h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><Youtube className="text-red-600"/> YouTube</h2><div className="flex gap-3 mb-6"><Input value={url} onChange={e=>setUrl(e.target.value)} placeholder="Link YouTube..." /><Button onClick={load} className="bg-red-600 hover:bg-red-700">Ph√°t</Button></div>{vid ? (<div className="space-y-4"><div className="aspect-video bg-black rounded-xl overflow-hidden shadow-2xl"><iframe className="w-full h-full" src={`https://www.youtube-nocookie.com/embed/${vid}?autoplay=1`} frameBorder="0" allowFullScreen></iframe></div><div className="p-4 bg-yellow-50 text-sm text-yellow-700 rounded-xl flex justify-between"><span><AlertCircle size={16} className="inline mr-2"/>N·∫øu l·ªói, h√£y m·ªü tr·ª±c ti·∫øp.</span><a href={`https://www.youtube.com/watch?v=${vid}`} target="_blank" className="font-bold underline flex gap-1">M·ªü Tab M·ªõi <ExternalLink size={14}/></a></div></div>) : (<div className="h-64 flex flex-col items-center justify-center bg-gray-50 rounded-xl border-2 border-dashed text-gray-400"><Video size={48} className="mb-2 opacity-50"/><p>Nh·∫≠p link ƒë·ªÉ xem</p></div>)}</Card></div>);
        };

        const AIChat = ({ apiKey, openSettings }) => {
            const [msgs, setMsgs] = useState([{role:'ai', text:'Ch√†o b·∫°n!'}]); const [txt, setTxt] = useState(''); const [load, setLoad] = useState(false); const endRef = useRef(null);
            useEffect(() => endRef.current?.scrollIntoView({behavior:'smooth'}), [msgs]);
            const send = async () => { if(!txt.trim()) return; if(!apiKey) return openSettings(); const u = txt; setMsgs(p => [...p, {role:'user', text:u}]); setTxt(''); setLoad(true); const res = await callGemini(u, apiKey); setMsgs(p => [...p, {role:'ai', text:res}]); setLoad(false); };
            return (<div className="max-w-3xl mx-auto h-[700px] flex flex-col animate-fade-in"><Card className="flex-1 flex flex-col p-0 overflow-hidden"><div className="p-4 border-b flex justify-between bg-white/50 backdrop-blur"><div className="flex items-center gap-3"><Bot className="text-purple-600"/><span className="font-bold">Gemini AI</span></div><Button variant="ghost" size="sm" onClick={() => setMsgs([])}><Trash2 size={16}/></Button></div><div className="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50/50">{msgs.map((m, i) => (<div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}><div className={`max-w-[85%] p-4 rounded-2xl text-sm whitespace-pre-wrap ${m.role === 'user' ? 'bg-primary-600 text-white' : 'bg-white border text-gray-700'}`}>{m.text}</div></div>))}{load && <div className="text-gray-400 text-xs ml-4">ƒêang vi·∫øt...</div>}<div ref={endRef}></div></div><div className="p-4 flex gap-3"><Input value={txt} onChange={e=>setTxt(e.target.value)} onKeyDown={e=>e.key==='Enter'&&send()} placeholder="H·ªèi g√¨ ƒë√≥..." /><Button onClick={send} disabled={load} icon={ArrowRight}></Button></div></Card></div>);
        };

        const Notes = ({ notes, setNotes, apiKey, openSettings }) => {
            const [cur, setCur] = useState({title:'', content:''}); const [mode, setMode] = useState('list'); const [load, setLoad] = useState(false);
            const save = () => { if(cur.title){ if(cur.id) setNotes(notes.map(n=>n.id===cur.id?cur:n)); else setNotes([...notes,{...cur, id:generateId(), date:new Date().toLocaleDateString('vi')}]); setMode('list'); setCur({title:'',content:''}); }};
            const magic = async (type) => { if(!apiKey) return openSettings(); if(!cur.content) return; setLoad(true); const res = await callGemini(type === 'fix' ? `S·ª≠a l·ªói: ${cur.content}` : `Vi·∫øt ti·∫øp: ${cur.content}`, apiKey); if(type === 'more') setCur({...cur, content: cur.content + ' ' + res}); else setCur({...cur, content: res}); setLoad(false); };
            if(mode === 'edit') return (<div className="max-w-3xl mx-auto animate-fade-in"><Card><div className="flex justify-between mb-4"><Button variant="ghost" onClick={() => setMode('list')} icon={ArrowLeft}>Quay l·∫°i</Button><div className="flex gap-2"><Button variant="secondary" size="sm" icon={Wand2} onClick={()=>magic('fix')} loading={load}>S·ª≠a</Button><Button variant="secondary" size="sm" icon={Sparkles} onClick={()=>magic('more')} loading={load}>Ti·∫øp</Button><Button onClick={save} icon={Save}>L∆∞u</Button></div></div><Input value={cur.title} onChange={e=>setCur({...cur, title:e.target.value})} placeholder="Ti√™u ƒë·ªÅ..." className="font-bold text-xl mb-4 border-none bg-transparent px-0" /><textarea value={cur.content} onChange={e=>setCur({...cur, content:e.target.value})} placeholder="Vi·∫øt g√¨ ƒë√≥..." className="w-full h-96 bg-transparent border-none outline-none resize-none text-gray-700 dark:text-gray-300" /></Card></div>);
            return (<div className="max-w-5xl mx-auto animate-fade-in"><div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold flex gap-2"><StickyNote className="text-yellow-500"/> Ghi ch√∫</h2><Button onClick={()=>{setCur({title:'',content:''}); setMode('edit')}} icon={Plus}>M·ªõi</Button></div><div className="grid grid-cols-1 md:grid-cols-3 gap-4">{notes.map(n => (<div key={n.id} onClick={()=>{setCur(n); setMode('edit')}} className="p-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-100 dark:border-yellow-800 rounded-2xl hover:shadow-lg cursor-pointer h-48 flex flex-col relative group"><h3 className="font-bold text-lg mb-2 truncate">{n.title}</h3><p className="text-sm text-gray-500 line-clamp-4 flex-1">{n.content}</p><button onClick={(e)=>{e.stopPropagation(); setNotes(notes.filter(x=>x.id!==n.id))}} className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-500"><Trash2 size={16}/></button></div>))}</div></div>);
        };

        const CalendarView = ({ tasks }) => {
            const today = new Date(); const dim = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate(); const fd = new Date(today.getFullYear(), today.getMonth(), 1).getDay();
            return (<div className="max-w-5xl mx-auto animate-fade-in"><Card><h2 className="text-2xl font-bold mb-8 flex gap-2"><CalendarIcon className="text-teal-500"/> Th√°ng {today.getMonth() + 1}</h2><div className="grid grid-cols-7 gap-2 md:gap-4">{Array.from({length:fd}).map((_,i)=><div key={i}></div>)}{Array.from({length:dim}).map((_,i)=>{const d=i+1; const t=tasks.filter(x=>new Date(x.date).getDate()===d); return (<div key={d} className="h-24 p-2 rounded-xl border bg-gray-50 hover:bg-white transition-all"><div className="font-bold text-sm mb-1">{d}</div><div className="space-y-1 overflow-y-auto max-h-[80%]">{t.map(k=><div key={k.id} className="text-[10px] bg-blue-100 text-blue-700 px-1 rounded truncate">{k.text}</div>)}</div></div>)})}</div></Card></div>);
        };

        const App = () => {
            const [tab, setTab] = useState('dashboard');
            const [sidebar, setSidebar] = useState(false);
            const [dark, setDark] = useState(false);
            const [weather, setWeather] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            
            // DATA
            const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem('tasks') || '[]'));
            const [notes, setNotes] = useState(() => JSON.parse(localStorage.getItem('notes') || '[]'));
            const [expenses, setExpenses] = useState(() => JSON.parse(localStorage.getItem('expenses') || '[]'));
            const [songs, setSongs] = useState(() => JSON.parse(localStorage.getItem('songs') || '[]'));
            const [vault, setVault] = useState(() => JSON.parse(localStorage.getItem('vault') || '[]'));
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('gemini_api_key') || '');

            useEffect(() => { localStorage.setItem('tasks', JSON.stringify(tasks)) }, [tasks]);
            useEffect(() => { localStorage.setItem('notes', JSON.stringify(notes)) }, [notes]);
            useEffect(() => { localStorage.setItem('expenses', JSON.stringify(expenses)) }, [expenses]);
            useEffect(() => { localStorage.setItem('songs', JSON.stringify(songs)) }, [songs]);
            useEffect(() => { localStorage.setItem('vault', JSON.stringify(vault)) }, [vault]);
            
            useEffect(() => { if(dark) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); }, [dark]);
            useEffect(() => { fetch('https://api.open-meteo.com/v1/forecast?latitude=21.0285&longitude=105.8542&current=temperature_2m&timezone=auto').then(r=>r.json()).then(d=>setWeather(d)).catch(()=>{}); }, []);

            const exportData = () => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify({tasks,notes,expenses,songs,vault})], {type:'application/json'})); a.download='workos-data.json'; a.click(); };
            const importData = (j) => { try { const d=JSON.parse(j); if(d.tasks)setTasks(d.tasks); if(d.notes)setNotes(d.notes); if(d.expenses)setExpenses(d.expenses); if(d.songs)setSongs(d.songs); if(d.vault)setVault(d.vault); alert("Th√†nh c√¥ng!"); } catch { alert("L·ªói file"); } };

            const menu = [
                {id:'dashboard', label:'T·ªïng quan', icon:Home}, {id:'kanban', label:'Vi·ªác l√†m', icon:Columns}, {id:'calendar', label:'L·ªãch', icon:CalendarIcon},
                {id:'notes', label:'Ghi ch√∫', icon:StickyNote}, {id:'aichat', label:'Tr·ª£ l√Ω AI', icon:Bot}, {id:'youtube', label:'YouTube', icon:Youtube},
                {id:'music', label:'Nh·∫°c', icon:Music}, {id:'finance', label:'T√†i ch√≠nh', icon:CreditCard}, {id:'crypto', label:'Crypto', icon:Bitcoin},
                {id:'vault', label:'Kho l∆∞u tr·ªØ', icon:Database}, {id:'devtools', label:'DevTools', icon:Code}, {id:'voice', label:'Ghi √¢m', icon:Mic},
                {id:'lucky', label:'V√≤ng quay', icon:Shuffle}, {id:'password', label:'M·∫≠t kh·∫©u', icon:Key}, {id:'qr', label:'M√£ QR', icon:QrCode},
                {id:'worldclock', label:'Gi·ªù TG', icon:Globe}, {id:'stopwatch', label:'B·∫•m gi·ªù', icon:Timer}
            ];

            if (tab === 'zen') return <ZenMode tasks={tasks} onClose={()=>setTab('dashboard')} />;

            return (
                <div className="min-h-screen flex bg-gray-50 dark:bg-dark-950 transition-colors duration-300 font-sans">
                    <aside className={`fixed md:static inset-y-0 left-0 z-40 w-72 bg-white dark:bg-dark-900 border-r border-gray-100 dark:border-gray-800 transform ${sidebar ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 transition-transform duration-300 flex flex-col`}>
                        <div className="p-6 flex items-center gap-3"><div className="w-10 h-10 bg-gradient-to-br from-primary-500 to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold shadow-lg">W</div><span className="text-xl font-bold">WorkOS 6.1</span></div>
                        <div className="px-4 flex-1 space-y-1 overflow-y-auto py-2 scrollbar-thin">
                            {menu.map(m => (<button key={m.id} onClick={() => {setTab(m.id); setSidebar(false)}} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-medium ${tab === m.id ? 'bg-primary-50 text-primary-600 dark:bg-primary-900/20 dark:text-primary-400' : 'text-gray-500 hover:bg-gray-50 dark:hover:bg-dark-800'}`}><m.icon size={18} /> {m.label}</button>))}
                        </div>
                        <div className="p-4 border-t border-gray-100 dark:border-gray-800 flex gap-2"><button onClick={()=>setDark(!dark)} className="flex-1 p-2 rounded-xl hover:bg-gray-100 flex justify-center text-gray-500">{dark ? <Sun size={20}/> : <Moon size={20}/>}</button><button onClick={()=>setShowSettings(true)} className="flex-1 p-2 rounded-xl hover:bg-gray-100 flex justify-center text-gray-500"><Settings size={20}/></button></div>
                    </aside>
                    <main className="flex-1 flex flex-col h-screen overflow-hidden relative">
                        <header className="md:hidden p-4 bg-white dark:bg-dark-900 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center z-20"><span className="font-bold">WorkOS 6.1</span><button onClick={()=>setSidebar(true)}><Menu/></button></header>
                        <div className="flex-1 overflow-auto p-4 md:p-8 scroll-smooth">
                            {tab === 'dashboard' && <Dashboard setActiveTab={setTab} tasks={tasks} weather={weather} openSettings={()=>setShowSettings(true)} />}
                            {tab === 'kanban' && <Kanban tasks={tasks} setTasks={setTasks} apiKey={apiKey} openSettings={()=>setShowSettings(true)} />}
                            {tab === 'youtube' && <YouTube />}
                            {tab === 'aichat' && <AIChat apiKey={apiKey} openSettings={()=>setShowSettings(true)} />}
                            {tab === 'notes' && <Notes notes={notes} setNotes={setNotes} apiKey={apiKey} openSettings={()=>setShowSettings(true)} />}
                            {tab === 'calendar' && <CalendarView tasks={tasks} />}
                            {tab === 'finance' && <FinanceApp expenses={expenses} setExpenses={setExpenses} />}
                            {tab === 'music' && <MusicPlayer songs={songs} setSongs={setSongs} />}
                            {tab === 'crypto' && <CryptoMarket />}
                            {tab === 'vault' && <VaultApp i={vault} sI={setVault} />}
                            {tab === 'devtools' && <DevToolsApp />}
                            {tab === 'voice' && <VoiceRecorder />}
                            {tab === 'lucky' && <LuckyWheel />}
                            {tab === 'worldclock' && <WorldClock />}
                            {tab === 'password' && <PasswordGen />}
                            {tab === 'qr' && <QRGen />}
                            {tab === 'stopwatch' && <StopwatchApp />}
                        </div>
                    </main>
                    <SettingsModal isOpen={showSettings} onClose={()=>setShowSettings(false)} apiKey={apiKey} setApiKey={setApiKey} exportData={exportData} importData={importData} />
                    {sidebar && <div className="fixed inset-0 bg-black/20 z-30 md:hidden" onClick={()=>setSidebar(false)}></div>}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>